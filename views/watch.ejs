<!DOCTYPE html>
<html lang="id">
<head>
    <%- include('layout/head') %>
</head>
<body class="bg-[#000] flex flex-col h-screen overflow-hidden">
    <nav class="shrink-0 bg-[#0f0f12] border-b border-white/10 px-4 py-3 flex items-center justify-between z-20">
        <div class="flex items-center gap-4">
            <a href="/anime/<%= anime.id %>" class="text-slate-400 hover:text-white transition p-1 rounded-full hover:bg-white/10">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
            </a>
            <h1 class="font-bold text-white text-sm md:text-base line-clamp-1 max-w-[200px] md:max-w-none"><%= anime.title %></h1>
        </div>
    </nav>

    <div class="flex-grow flex flex-col lg:flex-row overflow-hidden">
        <div class="w-full lg:w-3/4 bg-black flex flex-col relative group shrink-0">
            <div class="relative w-full aspect-video bg-black">
                <% if (url) { %>
                    <iframe src="<%= url %>" class="absolute inset-0 w-full h-full" frameborder="0" allowfullscreen></iframe>
                <% } else { %>
                    <div class="absolute inset-0 flex flex-col items-center justify-center text-slate-500 bg-slate-900/50">
                        <svg class="w-12 h-12 mb-2 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>
                        <p>Stream Error</p>
                    </div>
                <% } %>
            </div>
            
            <div class="p-4 bg-[#0f0f12] border-b border-white/5 lg:border-none">
                <div class="flex justify-between items-center mb-3">
                    <% 
                        const currentEpsIndex = anime.episodes.findIndex(e => e.id === currentEps);
                        const currentEpsData = anime.episodes[currentEpsIndex];
                        const displayTitle = currentEpsData ? currentEpsData.title : 'Episode ' + currentEps;
                        
                        let prevEps = null;
                        let nextEps = null;
                        
                        if (currentEpsIndex !== -1) {
                            if (currentEpsIndex > 0) prevEps = anime.episodes[currentEpsIndex - 1];
                            if (currentEpsIndex < anime.episodes.length - 1) nextEps = anime.episodes[currentEpsIndex + 1];
                        }
                    %>
                    <span class="text-xs font-bold text-purple-400 bg-purple-500/10 px-2 py-1 rounded border border-purple-500/20"><%= displayTitle %></span>
                    <div class="flex gap-2">
                        <% if(prevEps) { %>
                            <a href="/watch/<%= anime.id %>/<%= prevEps.id %>" class="text-xs bg-slate-800 hover:bg-slate-700 text-white px-3 py-1.5 rounded-lg transition flex items-center gap-1">
                                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg> Prev
                            </a>
                        <% } %>
                        <% if(nextEps) { %>
                            <a href="/watch/<%= anime.id %>/<%= nextEps.id %>" class="text-xs bg-purple-600 hover:bg-purple-700 text-white px-3 py-1.5 rounded-lg transition flex items-center gap-1">
                                Next <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                            </a>
                        <% } %>
                    </div>
                </div>
                <h2 class="text-white font-medium text-sm md:text-lg leading-tight"><%= anime.title %></h2>
            </div>
        </div>

        <div class="w-full lg:w-1/4 bg-[#0b0c15] border-l border-white/5 flex flex-col h-full min-h-0">
            <div class="p-3 border-b border-white/5 bg-[#0f0f12]">
                <h3 class="text-xs font-bold text-slate-400 uppercase tracking-wider">Daftar Episode</h3>
            </div>
            
            <div class="overflow-y-auto custom-scroll p-2 space-y-2 flex-grow">
                <% anime.episodes.forEach(eps => { %>
                    <a href="/watch/<%= anime.id %>/<%= eps.id %>" 
                       class="flex items-center gap-3 p-3 rounded-lg transition-all group <%= currentEps === eps.id ? 'bg-purple-600/10 border border-purple-500/50' : 'bg-slate-800/40 border border-transparent hover:bg-slate-800' %>">
                        
                        <div class="flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center <%= currentEps === eps.id ? 'bg-purple-600 text-white' : 'bg-slate-700 text-slate-400 group-hover:bg-slate-600' %>">
                            <% if(currentEps === eps.id) { %>
                                <svg class="w-3 h-3 animate-pulse" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                            <% } else { %>
                                <span class="text-[10px] font-bold"><%= eps.title.replace(/\D/g, '') %></span>
                            <% } %>
                        </div>
                        
                        <div class="flex-col overflow-hidden">
                            <span class="block text-sm font-medium truncate <%= currentEps === eps.id ? 'text-purple-300' : 'text-slate-300 group-hover:text-white' %>">
                                <%= eps.title %>
                            </span>
                            <span class="text-[10px] text-slate-500">Click to Play Episode</span>
                        </div>
                    </a>
                <% }) %>
            </div>
        </div>
    </div>
</body>
</html>
